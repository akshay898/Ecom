{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\project_e_commerce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\project_e_commerce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\project_e_commerce\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{CssBaseline,Paper,Stepper,Step,StepLabel,Typography,CircularProgress,Divider,Button}from'@material-ui/core';import{Link,useHistory}from'react-router-dom';import{commerce}from'../../../lib/commerce';import AddressForm from'../AddressForm';import PaymentForm from'../PaymentForm';import useStyles from'./styles';var steps=['Shipping address','Payment details'];var Checkout=function Checkout(_ref){var cart=_ref.cart,onCaptureCheckout=_ref.onCaptureCheckout,order=_ref.order,error=_ref.error;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),checkoutToken=_useState2[0],setCheckoutToken=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),activeStep=_useState4[0],setActiveStep=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),shippingData=_useState6[0],setShippingData=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isFinished=_useState8[0],setIsFinished=_useState8[1];var classes=useStyles();var history=useHistory();var nextStep=function nextStep(){return setActiveStep(function(prevActiveStep){return prevActiveStep+1;});};var backStep=function backStep(){return setActiveStep(function(prevActiveStep){return prevActiveStep-1;});};useEffect(function(){if(cart.id){var generateToken=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var token;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return commerce.checkout.generateToken(cart.id,{type:'cart'});case 3:token=_context.sent;setCheckoutToken(token);_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);if(activeStep!==steps.length)history.push('/');case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return function generateToken(){return _ref2.apply(this,arguments);};}();generateToken();}},[cart]);var test=function test(data){setShippingData(data);nextStep();};var timeout=function timeout(){setTimeout(function(){setIsFinished(true);},3000);};var Confirmation=function Confirmation(){return order.customer?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Typography,{variant:\"h5\"},\"Thank you for your purchase, \",order.customer.firstname,\" \",order.customer.lastname,\"!\"),/*#__PURE__*/React.createElement(Divider,{className:classes.divider}),/*#__PURE__*/React.createElement(Typography,{variant:\"subtitle2\"},\"Order ref: \",order.customer_reference)),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(Button,{component:Link,variant:\"outlined\",type:\"button\",to:\"/\"},\"Back to home\")):isFinished?/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Typography,{variant:\"h5\"},\"Thank you for your purchase!\"),/*#__PURE__*/React.createElement(Divider,{className:classes.divider})),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(Button,{component:Link,variant:\"outlined\",type:\"button\",to:\"/\"},\"Back to home\")):/*#__PURE__*/React.createElement(\"div\",{className:classes.spinner},/*#__PURE__*/React.createElement(CircularProgress,null));};if(error){Confirmation=function Confirmation(){return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Typography,{variant:\"h5\"},\"Error: \",error),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(Button,{component:Link,variant:\"outlined\",type:\"button\",to:\"/\"},\"Back to home\"));};}var Form=function Form(){return activeStep===0?/*#__PURE__*/React.createElement(AddressForm,{checkoutToken:checkoutToken,nextStep:nextStep,setShippingData:setShippingData,test:test}):/*#__PURE__*/React.createElement(PaymentForm,{checkoutToken:checkoutToken,nextStep:nextStep,backStep:backStep,shippingData:shippingData,onCaptureCheckout:onCaptureCheckout,timeout:timeout});};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(CssBaseline,null),/*#__PURE__*/React.createElement(\"div\",{className:classes.toolbar}),/*#__PURE__*/React.createElement(\"main\",{className:classes.layout},/*#__PURE__*/React.createElement(Paper,{className:classes.paper},/*#__PURE__*/React.createElement(Typography,{variant:\"h4\",align:\"center\"},\"Checkout\"),/*#__PURE__*/React.createElement(Stepper,{activeStep:activeStep,className:classes.stepper},steps.map(function(label){return/*#__PURE__*/React.createElement(Step,{key:label},/*#__PURE__*/React.createElement(StepLabel,null,label));})),activeStep===steps.length?/*#__PURE__*/React.createElement(Confirmation,null):checkoutToken&&/*#__PURE__*/React.createElement(Form,null))));};export default Checkout;","map":{"version":3,"sources":["C:/project_e_commerce/src/components/CheckoutForm/Checkout/Checkout.jsx"],"names":["React","useState","useEffect","CssBaseline","Paper","Stepper","Step","StepLabel","Typography","CircularProgress","Divider","Button","Link","useHistory","commerce","AddressForm","PaymentForm","useStyles","steps","Checkout","cart","onCaptureCheckout","order","error","checkoutToken","setCheckoutToken","activeStep","setActiveStep","shippingData","setShippingData","isFinished","setIsFinished","classes","history","nextStep","prevActiveStep","backStep","id","generateToken","checkout","type","token","length","push","test","data","timeout","setTimeout","Confirmation","customer","firstname","lastname","divider","customer_reference","spinner","Form","toolbar","layout","paper","stepper","map","label"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { CssBaseline, Paper, Stepper, Step, StepLabel, Typography, CircularProgress, Divider, Button } from '@material-ui/core';\r\nimport { Link, useHistory } from 'react-router-dom';\r\n\r\nimport { commerce } from '../../../lib/commerce';\r\nimport AddressForm from '../AddressForm';\r\nimport PaymentForm from '../PaymentForm';\r\nimport useStyles from './styles';\r\n\r\nconst steps = ['Shipping address', 'Payment details'];\r\n\r\nconst Checkout = ({ cart, onCaptureCheckout, order, error }) => {\r\n  const [checkoutToken, setCheckoutToken] = useState(null);\r\n  const [activeStep, setActiveStep] = useState(0);\r\n  const [shippingData, setShippingData] = useState({});\r\n  const [isFinished, setIsFinished] = useState(false);\r\n  const classes = useStyles();\r\n  const history = useHistory();\r\n\r\n  const nextStep = () => setActiveStep((prevActiveStep) => prevActiveStep + 1);\r\n  const backStep = () => setActiveStep((prevActiveStep) => prevActiveStep - 1);\r\n\r\n  useEffect(() => {\r\n    if (cart.id) {\r\n      const generateToken = async () => {\r\n        try {\r\n          const token = await commerce.checkout.generateToken(cart.id, { type: 'cart' });\r\n\r\n          setCheckoutToken(token);\r\n        } catch {\r\n          if (activeStep !== steps.length) history.push('/');\r\n        }\r\n      };\r\n\r\n      generateToken();\r\n    }\r\n  }, [cart]);\r\n\r\n  const test = (data) => {\r\n    setShippingData(data);\r\n\r\n    nextStep();\r\n  };\r\n\r\n  const timeout = () => {\r\n    setTimeout(() => {\r\n      setIsFinished(true)\r\n    }, 3000);\r\n  }\r\n\r\n  let Confirmation = () => (order.customer ? (\r\n    <>\r\n      <div>\r\n        <Typography variant=\"h5\">Thank you for your purchase, {order.customer.firstname} {order.customer.lastname}!</Typography>\r\n        <Divider className={classes.divider} />\r\n        <Typography variant=\"subtitle2\">Order ref: {order.customer_reference}</Typography>\r\n      </div>\r\n      <br />\r\n      <Button component={Link} variant=\"outlined\" type=\"button\" to=\"/\">Back to home</Button>\r\n    </>\r\n  ) : isFinished ?  (\r\n    <>\r\n    <div>\r\n      <Typography variant=\"h5\">Thank you for your purchase!</Typography>\r\n      <Divider className={classes.divider} />\r\n    </div>\r\n    <br />\r\n    <Button component={Link} variant=\"outlined\" type=\"button\" to=\"/\">Back to home</Button>\r\n  </>\r\n  ):(\r\n    <div className={classes.spinner}>\r\n      <CircularProgress />\r\n    </div>\r\n  ));\r\n\r\n  if (error) {\r\n    Confirmation = () => (\r\n      <>\r\n        <Typography variant=\"h5\">Error: {error}</Typography>\r\n        <br />\r\n        <Button component={Link} variant=\"outlined\" type=\"button\" to=\"/\">Back to home</Button>\r\n      </>\r\n    );\r\n  }\r\n\r\n  const Form = () => (activeStep === 0\r\n    ? <AddressForm checkoutToken={checkoutToken} nextStep={nextStep} setShippingData={setShippingData} test={test} />\r\n    : <PaymentForm checkoutToken={checkoutToken} nextStep={nextStep} backStep={backStep} shippingData={shippingData} onCaptureCheckout={onCaptureCheckout} timeout={timeout}/>);\r\n\r\n  return (\r\n    <>\r\n      <CssBaseline />\r\n      <div className={classes.toolbar} />\r\n      <main className={classes.layout}>\r\n        <Paper className={classes.paper}>\r\n          <Typography variant=\"h4\" align=\"center\">Checkout</Typography>\r\n          <Stepper activeStep={activeStep} className={classes.stepper}>\r\n            {steps.map((label) => (\r\n              <Step key={label}>\r\n                <StepLabel>{label}</StepLabel>\r\n              </Step>\r\n            ))}\r\n          </Stepper>\r\n          {activeStep === steps.length ? <Confirmation /> : checkoutToken && <Form />}\r\n        </Paper>\r\n      </main>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Checkout;\r\n"]},"metadata":{},"sourceType":"module"}